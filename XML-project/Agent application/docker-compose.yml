version: '3'
services:

  agent-1-mysql:
   container_name: sql-ws-2
   image: mysql/mysql-server:5.7
   environment:
    MYSQL_DATABASE: root
    MYSQL_ROOT_PASSWORD: root
    MYSQL_ROOT_HOST: '%'
   ports:
   - "8005:3306"
   restart: always

  agent-2-mysql:
   container_name: sql-ws-1
   image: mysql/mysql-server:5.7
   environment:
    MYSQL_DATABASE: root
    MYSQL_ROOT_PASSWORD: root
    MYSQL_ROOT_HOST: '%'
   ports:
   - "8006:3307"
   restart: always

  ws-agent-1:
    container_name: ws-agent-1
    restart: always
    build: .
    working_dir: /app
    volumes:
      - .:/app
      - ~/.m2:/root/.m2
    ports:
      - "8080:8080"
    environment:
      - INSTANCE_NO=1
      - INSTANCE_DATABASE=agent-1-mysql
      - DATABASE_SOURCE=jdbc:mysql://agent-1-mysql:3306/xml_db
      - ENV_INSTANCE_AGENT_USERNAME=agentOne
      - ENV_INSTANCE_AGENT_PASSWORD=agentOne
      - ENV_INSTANCE_URL="localhost:8080"
    command: mvn  spring-boot:run
    depends_on:
      - agent-1-mysql

  ws-agent-2:
    container_name: ws-agent-2
    restart: always
    build: .
    working_dir: /app
    volumes:
      - .:/app
      - ~/.m2:/root/.m2
    ports:
      - "8081:8080"
    environment:
      - INSTANCE_NO=2
      - INSTANCE_DATABASE=agent-2-mysql
      - DATABASE_SOURCE=jdbc:mysql://agent-2-mysql:3306/xml_db
      - ENV_INSTANCE_AGENT_USERNAME=agentTwo
      - ENV_INSTANCE_AGENT_PASSWORD=agentTwo
      - ENV_INSTANCE_URL="localhost:8081"
    command: mvn  spring-boot:run
    depends_on:
      - agent-2-mysql

